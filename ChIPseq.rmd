---
title: "P3F_ChIP_6hpf_byJack"
author: "Jack Kucinski and Matt Cannon"
date: "`r format(Sys.time(), '%m/%d/%Y')`"
output: 
    html_document:
        toc: true
        toc_float: true
        toc_depth: 5
        number_sections: false
        code_folding: hide
---

# Title P3F_ChIP_6hpf_byJack

## Goals: 
To analyze my first publishable ChIP-seq datasets in parallel with Matt Cannon to gain bioinformatics skills

## Samples
JPK0028	GSL-JK-3260 EID1602 P3F anti-FOXO1 ChIP 1
JPK0029	GSL-JK-3260 EID1602 P3F anti-FOXO1 Input 1
JPK0030	GSL-JK-3260 EID1602 CNTL anti-FOXO1 ChIP 1
JPK0031	GSL-JK-3260 EID1602 CNTL anti-FOXO1 Input 1
JPK0032	GSL-JK-3260 EID1622 P3F anti-FOXO1 ChIP 2
JPK0033	GSL-JK-3260 EID1622 P3F anti-FOXO1 Input 2
JPK0034	GSL-JK-3260 EID1622 CNTL anti-FOXO1 ChIP 2
JPK0035	GSL-JK-3260 EID1622 CNTL anti-FOXO1 Input 2
JPK0036	GSL-JK-3260 EID1776 P3F anti-H3K27Ac ChIP 1
JPK0037	GSL-JK-3260 EID1776 P3F anti-H3K27Ac Input 1
JPK0038	GSL-JK-3260 EID1776 CNTL anti-H3K27Ac ChIP 1 
JPK0039	GSL-JK-3260 EID1776 CNTL anti-H3K27Ac Input 1 
JPK0040	GSL-JK-3260 EID1777 P3F anti-H3K27Ac ChIP 2
JPK0041	GSL-JK-3260 EID1777 P3F anti-H3K27Ac Input 2 
JPK0042	GSL-JK-3260 EID1777 CNTL anti-H3K27Ac ChIP 2 
JPK0043	GSL-JK-3260 EID1777 CNTL anti-H3K27Ac Input 2 

# Workflow


# Load packages
```{r lib}
library(tidyverse)
theme_set(theme_bw())
theme_update(plot.title = element_text(hjust = 0.5))
```

## Make up directory structure
```{bash mkdirs, eval=TRUE}
for directoryName in \
    misc \
    output \
    output/figures \
    output/counts \
    output/align/chip \
    output/align/rna \
    output/peaks \
    output/gene_counts
do
    if [ ! -d ${directoryName} ]
    then
        mkdir -p ${directoryName}
    fi
done
```

## Align ChIPseq libraries to zebrafish genome, index, and remove duplicates
```{bash}
sbatch sbatchCmds/align_chip.sh
```

## call peaks
```{bash}
echo $HOSTNAME $SLURM_ARRAY_TASK_ID

module purge
module load GCC/7.3.0-2.30 \
            OpenMPI/3.1.1 \
            MACS2/2.2.5-Python-3.6.6

fileArray=(JPK0028
           JPK0030
           JPK0032
           JPK0034
           JPK0036
           JPK0038
           JPK0040
           JPK0042)
           
controlArray=(JPK0029
              JPK0031
              JPK0033
              JPK0035
              JPK0037
              JPK0039
              JPK0041
              JPK0043)

macs2 callpeak \
  -t /home/gdkendalllab/lab/analyses/rsjxk002/P3F_ChIP_6hpf/align_nosplice/${fileArray[${SLURM_ARRAY_TASK_ID}]}_dedupd.bam \
  -c /home/gdkendalllab/lab/analyses/rsjxk002/P3F_ChIP_6hpf/align_nosplice/${controlArray[${SLURM_ARRAY_TASK_ID}]}_dedupd.bam \
  -n ${fileArray[${SLURM_ARRAY_TASK_ID}]} \
  -f BAMPE \
  -B \
  -g 1679203469 \
  --keep-dup all
```
